From 2c1f4024ccda983c88c8d3b5c1f5103b4911b711 Mon Sep 17 00:00:00 2001
From: florent Richard <florent.r08@live.fr>
Date: Mon, 26 Apr 2021 12:11:37 +0200
Subject: [PATCH] =?UTF-8?q?Ajout=20de=20la=20fonctionnalit=C3=A9=20pour=20?=
 =?UTF-8?q?supprimer=20une=20absence?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 MediaTek86/controle/Controle.cs         | 16 +++++++++++++++
 MediaTek86/dal/AccesDonnees.cs          | 16 +++++++++++++++
 MediaTek86/vue/GererAbsence.Designer.cs |  1 +
 MediaTek86/vue/GererAbsence.cs          | 26 +++++++++++++++++++++++++
 4 files changed, 59 insertions(+)

diff --git a/MediaTek86/controle/Controle.cs b/MediaTek86/controle/Controle.cs
index c2f6c9e..0fa8c37 100644
--- a/MediaTek86/controle/Controle.cs
+++ b/MediaTek86/controle/Controle.cs
@@ -193,5 +193,21 @@ namespace MediaTek86.controle
             AccesDonnees.AddAbsence(absence);
             frmGererAbsence.RemplirListeAbsence(personnel);
         }
+
+        /// <summary>
+        /// Demande de suppression d'une absence
+        /// </summary>
+        /// <param name="absence"></param>
+        public void DelAbsence()
+        {
+            Absence absence = (Absence)frmGererAbsence.bdgAbsence.List[frmGererAbsence.bdgAbsence.Position];
+            Personnel personnel = new Personnel(frmGererAbsence.GetIdPersonnel(), null, null, null, null, 0, null);
+            if (MessageBox.Show("Voulez-vous vraiment supprimer " + personnel.Nom + " " + personnel.Prenom + " ?", "Confirmation de suppression", MessageBoxButtons.YesNo) == DialogResult.Yes)
+            {
+                AccesDonnees.DelAbsence(absence);
+                frmGererAbsence.RemplirListeAbsence(personnel);
+            }
+            
+        }
     }
 }
diff --git a/MediaTek86/dal/AccesDonnees.cs b/MediaTek86/dal/AccesDonnees.cs
index 899dac1..2a51c4d 100644
--- a/MediaTek86/dal/AccesDonnees.cs
+++ b/MediaTek86/dal/AccesDonnees.cs
@@ -167,6 +167,22 @@ namespace MediaTek86.dal
             conn.ReqUpdate(req, parameters);
         }
 
+        /// <summary>
+        /// Suppression d'une absence
+        /// </summary>
+        /// <param name="absence"></param>
+        public static void DelAbsence(Absence absence)
+        {
+            string req = "delete from absence where idpersonnel = @idpersonnel and idmotif = @idmotif and datedebut = @datedebut and datefin = @datefin;";
+            Dictionary<string, object> parameters = new Dictionary<string, object>();
+            parameters.Add("@idpersonnel", absence.Idpersonnel);
+            parameters.Add("@datedebut", absence.Date_de_debut);
+            parameters.Add("@datefin", absence.Date_de_fin);
+            parameters.Add("@idmotif", absence.Idmotif);
+            ConnexionBDD conn = ConnexionBDD.GetInstance(connectionString);
+            conn.ReqUpdate(req, parameters);
+        }
+
     }
 
 }
diff --git a/MediaTek86/vue/GererAbsence.Designer.cs b/MediaTek86/vue/GererAbsence.Designer.cs
index 07a6b7a..f203060 100644
--- a/MediaTek86/vue/GererAbsence.Designer.cs
+++ b/MediaTek86/vue/GererAbsence.Designer.cs
@@ -125,6 +125,7 @@
             this.btnSupAbsence.TabIndex = 16;
             this.btnSupAbsence.Text = "Supprimer l\'absence";
             this.btnSupAbsence.UseVisualStyleBackColor = true;
+            this.btnSupAbsence.Click += new System.EventHandler(this.btnSupAbsence_Click);
             // 
             // dgvAbsence
             // 
diff --git a/MediaTek86/vue/GererAbsence.cs b/MediaTek86/vue/GererAbsence.cs
index df40c9b..cd3c385 100644
--- a/MediaTek86/vue/GererAbsence.cs
+++ b/MediaTek86/vue/GererAbsence.cs
@@ -137,6 +137,11 @@ namespace MediaTek86.vue
             GererZoneTexte(false);
         }
 
+        /// <summary>
+        /// Remplis les zones de texte au chargement de la fenêtre
+        /// </summary>
+        /// <param name="sender"></param>
+        /// <param name="e"></param>
         private void frmGererAbsence_Load(object sender, EventArgs e)
         {
             txtNom.Text = GetNom();
@@ -170,6 +175,11 @@ namespace MediaTek86.vue
             dgvAbsence.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.AllCells;
         }
 
+        /// <summary>
+        /// Retourne à la liste du personnel
+        /// </summary>
+        /// <param name="sender"></param>
+        /// <param name="e"></param>
         private void btnRetourListePerso_Click(object sender, EventArgs e)
         {
             controle.RetourListePerso();
@@ -212,5 +222,21 @@ namespace MediaTek86.vue
             GererZoneTexte(false);
         }
 
+        /// <summary>
+        /// Suuprime l'absence séléctionné
+        /// </summary>
+        /// <param name="sender"></param>
+        /// <param name="e"></param>
+        private void btnSupAbsence_Click(object sender, EventArgs e)
+        {
+            if (dgvAbsence.SelectedRows.Count > 0)
+            {
+                controle.DelAbsence();
+            }
+            else
+            {
+                MessageBox.Show("Une ligne doit être sélectionnée.", "Information");
+            }
+        }
     }
 }
-- 
2.49.0.windows.1

