From 59202c2f0d06398d38676eba1e5a78071ce03781 Mon Sep 17 00:00:00 2001
From: florent Richard <florent.r08@live.fr>
Date: Wed, 19 May 2021 23:00:46 +0200
Subject: [PATCH] =?UTF-8?q?R=C3=A9solution=20de=20bug=20sur=20la=20suppres?=
 =?UTF-8?q?sion=20d'un=20personnel=20et=20ajout=20de=20commentaire=20manqu?=
 =?UTF-8?q?ant?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 MediaTek86/MediaTek86.csproj         | 50 +++++++++++++++++++-
 MediaTek86/Properties/app.manifest   | 70 ++++++++++++++++++++++++++++
 MediaTek86/connexion/ConnexionBDD.cs |  3 +-
 MediaTek86/controle/Controle.cs      | 11 ++++-
 MediaTek86/dal/AccesDonnees.cs       | 14 +++++-
 MediaTek86/modele/Absence.cs         | 21 +++++++++
 MediaTek86/modele/Motif.cs           |  8 +++-
 MediaTek86/modele/Personnel.cs       | 22 +++++++++
 MediaTek86/modele/Service.cs         |  9 ++++
 MediaTek86/vue/GererAbsence.cs       |  2 -
 MediaTek86/vue/ListePersonnel.cs     |  6 +++
 11 files changed, 208 insertions(+), 8 deletions(-)
 create mode 100644 MediaTek86/Properties/app.manifest

diff --git a/MediaTek86/MediaTek86.csproj b/MediaTek86/MediaTek86.csproj
index 946648f..797e385 100644
--- a/MediaTek86/MediaTek86.csproj
+++ b/MediaTek86/MediaTek86.csproj
@@ -12,6 +12,22 @@
     <FileAlignment>512</FileAlignment>
     <AutoGenerateBindingRedirects>true</AutoGenerateBindingRedirects>
     <Deterministic>true</Deterministic>
+    <IsWebBootstrapper>false</IsWebBootstrapper>
+    <PublishUrl>publish\</PublishUrl>
+    <Install>true</Install>
+    <InstallFrom>Disk</InstallFrom>
+    <UpdateEnabled>false</UpdateEnabled>
+    <UpdateMode>Foreground</UpdateMode>
+    <UpdateInterval>7</UpdateInterval>
+    <UpdateIntervalUnits>Days</UpdateIntervalUnits>
+    <UpdatePeriodically>false</UpdatePeriodically>
+    <UpdateRequired>false</UpdateRequired>
+    <MapFileExtensions>true</MapFileExtensions>
+    <ApplicationRevision>1</ApplicationRevision>
+    <ApplicationVersion>1.0.0.%2a</ApplicationVersion>
+    <UseApplicationTrust>false</UseApplicationTrust>
+    <PublishWizardCompleted>true</PublishWizardCompleted>
+    <BootstrapperEnabled>true</BootstrapperEnabled>
   </PropertyGroup>
   <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
     <PlatformTarget>AnyCPU</PlatformTarget>
@@ -22,6 +38,7 @@
     <DefineConstants>DEBUG;TRACE</DefineConstants>
     <ErrorReport>prompt</ErrorReport>
     <WarningLevel>4</WarningLevel>
+    <DocumentationFile>bin\Debug\MediaTek86.xml</DocumentationFile>
   </PropertyGroup>
   <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
     <PlatformTarget>AnyCPU</PlatformTarget>
@@ -32,6 +49,24 @@
     <ErrorReport>prompt</ErrorReport>
     <WarningLevel>4</WarningLevel>
   </PropertyGroup>
+  <PropertyGroup>
+    <ManifestCertificateThumbprint>CE18D78B5DAD60E4E6D7C6D32961DB56D173C592</ManifestCertificateThumbprint>
+  </PropertyGroup>
+  <PropertyGroup>
+    <ManifestKeyFile>MediaTek86_TemporaryKey.pfx</ManifestKeyFile>
+  </PropertyGroup>
+  <PropertyGroup>
+    <GenerateManifests>true</GenerateManifests>
+  </PropertyGroup>
+  <PropertyGroup>
+    <TargetZone>LocalIntranet</TargetZone>
+  </PropertyGroup>
+  <PropertyGroup>
+    <ApplicationManifest>Properties\app.manifest</ApplicationManifest>
+  </PropertyGroup>
+  <PropertyGroup>
+    <SignManifests>true</SignManifests>
+  </PropertyGroup>
   <ItemGroup>
     <Reference Include="BouncyCastle.Crypto, Version=1.8.5.0, Culture=neutral, PublicKeyToken=0e99375e54769942">
       <HintPath>..\packages\BouncyCastle.1.8.5\lib\BouncyCastle.Crypto.dll</HintPath>
@@ -157,7 +192,9 @@
     <EmbeddedResource Include="vue\SeConnecter.resx">
       <DependentUpon>SeConnecter.cs</DependentUpon>
     </EmbeddedResource>
+    <None Include="MediaTek86_TemporaryKey.pfx" />
     <None Include="packages.config" />
+    <None Include="Properties\app.manifest" />
     <None Include="Properties\Settings.settings">
       <Generator>SettingsSingleFileGenerator</Generator>
       <LastGenOutput>Settings.Designer.cs</LastGenOutput>
@@ -171,6 +208,17 @@
   <ItemGroup>
     <None Include="App.config" />
   </ItemGroup>
-  <ItemGroup />
+  <ItemGroup>
+    <BootstrapperPackage Include=".NETFramework,Version=v4.7.2">
+      <Visible>False</Visible>
+      <ProductName>Microsoft .NET Framework 4.7.2 %28x86 et x64%29</ProductName>
+      <Install>true</Install>
+    </BootstrapperPackage>
+    <BootstrapperPackage Include="Microsoft.Net.Framework.3.5.SP1">
+      <Visible>False</Visible>
+      <ProductName>.NET Framework 3.5 SP1</ProductName>
+      <Install>false</Install>
+    </BootstrapperPackage>
+  </ItemGroup>
   <Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />
 </Project>
\ No newline at end of file
diff --git a/MediaTek86/Properties/app.manifest b/MediaTek86/Properties/app.manifest
new file mode 100644
index 0000000..fa7d7ca
--- /dev/null
+++ b/MediaTek86/Properties/app.manifest
@@ -0,0 +1,70 @@
+﻿<?xml version="1.0" encoding="utf-8"?>
+<assembly manifestVersion="1.0" xmlns="urn:schemas-microsoft-com:asm.v1">
+  <assemblyIdentity version="1.0.0.0" name="MyApplication.app" />
+  <trustInfo xmlns="urn:schemas-microsoft-com:asm.v2">
+    <security>
+      <requestedPrivileges xmlns="urn:schemas-microsoft-com:asm.v3">
+        <!-- Options du manifeste de contrôle de compte d'utilisateur
+             Si vous souhaitez modifier le niveau du contrôle de compte d'utilisateur Windows, remplacez le 
+             nœud requestedExecutionLevel par l'une des propositions suivantes.
+
+        <requestedExecutionLevel  level="asInvoker" uiAccess="false" />
+        <requestedExecutionLevel  level="requireAdministrator" uiAccess="false" />
+        <requestedExecutionLevel  level="highestAvailable" uiAccess="false" />
+
+            La spécification de l'élément requestedExecutionLevel désactive la virtualisation de fichiers et du Registre. 
+            Supprimez cet élément si votre application a besoin de la virtualisation pour des
+            raisons de compatibilité descendante.
+        -->
+        <requestedExecutionLevel level="asInvoker" uiAccess="false" />
+      </requestedPrivileges>
+      <applicationRequestMinimum>
+        <PermissionSet class="System.Security.PermissionSet" version="1" Unrestricted="true" ID="Custom" SameSite="site" />
+        <defaultAssemblyRequest permissionSetReference="Custom" />
+      </applicationRequestMinimum>
+    </security>
+  </trustInfo>
+  <compatibility xmlns="urn:schemas-microsoft-com:compatibility.v1">
+    <application>
+      <!-- Liste des versions de Windows pour lesquelles cette application a été testée,
+           et sur lesquelles elle doit fonctionner. Décommentez éléments appropriés,
+           et Windows va automatiquement sélectionner l'environnement le plus compatible. -->
+      <!-- Windows Vista -->
+      <!--<supportedOS Id="{e2011457-1546-43c5-a5fe-008deee3d3f0}" />-->
+      <!-- Windows 7 -->
+      <!--<supportedOS Id="{35138b9a-5d96-4fbd-8e2d-a2440225f93a}" />-->
+      <!-- Windows 8 -->
+      <!--<supportedOS Id="{4a2f28e3-53b9-4441-ba9c-d69d4a4a6e38}" />-->
+      <!-- Windows 8.1 -->
+      <!--<supportedOS Id="{1f676c76-80e1-4239-95bb-83d0f6d0da78}" />-->
+      <!-- Windows 10 -->
+      <!--<supportedOS Id="{8e0f7a12-bfb3-4fe8-b9a5-48fd50a15a9a}" />-->
+    </application>
+  </compatibility>
+  <!-- Indique que l'application prend en charge DPI et qu'elle n'est pas automatiquement mise à l'échelle par Windows à un niveau de
+       DPI plus élevé. Les applications Windows Presentation Foundation (WPF) prennent automatiquement en charge DPI et n'ont pas besoin 
+       d'opter pour ce choix. Les applications Windows Forms qui ciblent .NET Framework 4.6 et qui optent pour ce paramètre, doivent 
+       également affecter la valeur 'true' au paramètre 'EnableWindowsFormsHighDpiAutoResizing' dans leur fichier app.config. -->
+  <!--
+  <application xmlns="urn:schemas-microsoft-com:asm.v3">
+    <windowsSettings>
+      <dpiAware xmlns="http://schemas.microsoft.com/SMI/2005/WindowsSettings">true</dpiAware>
+    </windowsSettings>
+  </application>
+  -->
+  <!-- Activer les thèmes pour les contrôles et boîtes de dialogue communes de Windows (Windows XP et version ultérieure) -->
+  <!--
+  <dependency>
+    <dependentAssembly>
+      <assemblyIdentity
+          type="win32"
+          name="Microsoft.Windows.Common-Controls"
+          version="6.0.0.0"
+          processorArchitecture="*"
+          publicKeyToken="6595b64144ccf1df"
+          language="*"
+        />
+    </dependentAssembly>
+  </dependency>
+  -->
+</assembly>
\ No newline at end of file
diff --git a/MediaTek86/connexion/ConnexionBDD.cs b/MediaTek86/connexion/ConnexionBDD.cs
index 2d8094f..9b146cf 100644
--- a/MediaTek86/connexion/ConnexionBDD.cs
+++ b/MediaTek86/connexion/ConnexionBDD.cs
@@ -91,7 +91,8 @@ namespace MediaTek86.connexion
         /// <summary>
         /// Exécute une requête type "select" et valorise le curseur
         /// </summary>
-        /// <param name="stringQuery">requête select</param>
+        /// <param name="stringQuery"></param>
+        /// <param name="parameters"></param>
         public void ReqSelect(string stringQuery, Dictionary<string, object> parameters)
         {
             try
diff --git a/MediaTek86/controle/Controle.cs b/MediaTek86/controle/Controle.cs
index 3a1a12d..3cfaed0 100644
--- a/MediaTek86/controle/Controle.cs
+++ b/MediaTek86/controle/Controle.cs
@@ -158,6 +158,7 @@ namespace MediaTek86.controle
             Personnel personnel = (Personnel)frmListePersonnel.bdgPersonnel.List[frmListePersonnel.bdgPersonnel.Position];
             if (MessageBox.Show("Voulez-vous vraiment supprimer " + personnel.Nom + " " + personnel.Prenom + " ?", "Confirmation de suppression", MessageBoxButtons.YesNo) == DialogResult.Yes)
             {
+                AccesDonnees.DelAllAbsence(personnel);
                 AccesDonnees.DelPersonnel(personnel);
             }
         }
@@ -181,6 +182,9 @@ namespace MediaTek86.controle
             frmModificationPersonnel.ShowDialog();
         }
 
+        /// <summary>
+        /// Demande pour acceder à la modification d'une absence
+        /// </summary>
         public void DemUpdateAbsence()
         {
             // Ferme la fenêtre active
@@ -254,7 +258,11 @@ namespace MediaTek86.controle
         /// <summary>
         /// Demande d'ajout d'une absence
         /// </summary>
-        /// <param name="absence"></param>
+        /// <param name="idpersonnel"></param>
+        /// <param name="nom"></param>
+        /// <param name="prenom"></param>
+        /// <param name="datedebut"></param>
+        /// <param name="datefin"></param>
         public void AddAbsence(int idpersonnel, string nom, string prenom, DateTime datedebut, DateTime datefin)
         {
             Console.WriteLine(frmGererAbsence.GetIdPersonnel());
@@ -268,7 +276,6 @@ namespace MediaTek86.controle
         /// <summary>
         /// Demande de suppression d'une absence
         /// </summary>
-        /// <param name="absence"></param>
         public void DelAbsence()
         {
             Absence absence = (Absence)frmGererAbsence.bdgAbsence.List[frmGererAbsence.bdgAbsence.Position];
diff --git a/MediaTek86/dal/AccesDonnees.cs b/MediaTek86/dal/AccesDonnees.cs
index e5178e8..2953831 100644
--- a/MediaTek86/dal/AccesDonnees.cs
+++ b/MediaTek86/dal/AccesDonnees.cs
@@ -8,7 +8,6 @@ using System.Threading.Tasks;
 
 namespace MediaTek86.dal
 {
-
     public class AccesDonnees
     {
         /// <summary>
@@ -194,6 +193,19 @@ namespace MediaTek86.dal
             conn.ReqUpdate(req, parameters);
         }
 
+        /// <summary>
+        /// Supprime la totalité des absences d'un personel
+        /// </summary>
+        /// <param name="personnel"></param>
+        public static void DelAllAbsence(Personnel personnel)
+        {
+            string req = "delete from absence where idpersonnel = @idpersonnel;";
+            Dictionary<string, object> parameters = new Dictionary<string, object>();
+            parameters.Add("@idpersonnel", personnel.Idpersonnel);
+            ConnexionBDD conn = ConnexionBDD.GetInstance(connectionString);
+            conn.ReqUpdate(req, parameters);
+        }
+
         /// <summary>
         /// Suppression d'une absence
         /// </summary>
diff --git a/MediaTek86/modele/Absence.cs b/MediaTek86/modele/Absence.cs
index c32341f..e6da235 100644
--- a/MediaTek86/modele/Absence.cs
+++ b/MediaTek86/modele/Absence.cs
@@ -20,12 +20,33 @@ namespace MediaTek86.modele
         private int idmotif;
         private string motif;
 
+        /// <summary>
+        /// Retourne idpersonnel
+        /// </summary>
         public int Idpersonnel { get => idpersonnel; }
+        /// <summary>
+        /// Retourne nom
+        /// </summary>
         public string Nom { get => nom; }
+        /// <summary>
+        /// Retourne prenom
+        /// </summary>
         public string Prenom { get => prenom; }
+        /// <summary>
+        /// Retourne datedebut
+        /// </summary>
         public DateTime Date_de_debut { get => datedebut; }
+        /// <summary>
+        /// Retourne datefin
+        /// </summary>
         public DateTime Date_de_fin { get => datefin; }
+        /// <summary>
+        /// Retourne idmotif
+        /// </summary>
         public int Idmotif { get => idmotif; }
+        /// <summary>
+        /// Retourne motif
+        /// </summary>
         public string Motif { get => motif; }
 
         /// <summary>
diff --git a/MediaTek86/modele/Motif.cs b/MediaTek86/modele/Motif.cs
index f1a9cfc..ea3d6ad 100644
--- a/MediaTek86/modele/Motif.cs
+++ b/MediaTek86/modele/Motif.cs
@@ -14,8 +14,14 @@ namespace MediaTek86.modele
         // Déclaration des propriétés
         private int idmotif;
         private string libelle;
-
+        
+        /// <summary>
+        /// Retourne idmotif
+        /// </summary>
         public int Idmotif { get => idmotif; }
+        /// <summary>
+        /// Retourne libelle
+        /// </summary>
         public string Libelle { get => libelle; }
 
         /// <summary>
diff --git a/MediaTek86/modele/Personnel.cs b/MediaTek86/modele/Personnel.cs
index 7075847..c9450a7 100644
--- a/MediaTek86/modele/Personnel.cs
+++ b/MediaTek86/modele/Personnel.cs
@@ -19,12 +19,33 @@ namespace MediaTek86.modele
         private int idservice;
         private string service;
 
+        /// <summary>
+        /// Retourne idpersonel
+        /// </summary>
         public int Idpersonnel { get => idpersonnel; }
+        /// <summary>
+        /// Retourne nom
+        /// </summary>
         public string Nom { get => nom; }
+        /// <summary>
+        /// Retourne prenom
+        /// </summary>
         public string Prenom { get => prenom; }
+        /// <summary>
+        /// Retourne tel
+        /// </summary>
         public string Tel { get => tel; }
+        /// <summary>
+        /// Retourne mail
+        /// </summary>
         public string Mail { get => mail; }
+        /// <summary>
+        /// Retourne idservice
+        /// </summary>
         public int Idservice { get => idservice; }
+        /// <summary>
+        /// Retourne service
+        /// </summary>
         public string Service { get => service; }
 
         /// <summary>
@@ -36,6 +57,7 @@ namespace MediaTek86.modele
         /// <param name="tel"></param>
         /// <param name="mail"></param>
         /// <param name="idservice"></param>
+        /// <param name="service"></param>
         public Personnel(int idpersonnel, string nom, string prenom, string tel, string mail, int idservice, string service)
         {
             this.idpersonnel = idpersonnel;
diff --git a/MediaTek86/modele/Service.cs b/MediaTek86/modele/Service.cs
index ae94d28..630e345 100644
--- a/MediaTek86/modele/Service.cs
+++ b/MediaTek86/modele/Service.cs
@@ -6,12 +6,21 @@ using System.Threading.Tasks;
 
 namespace MediaTek86.modele
 {
+    /// <summary>
+    /// Classe Service
+    /// </summary>
     public class Service
     {
         private int idservice;
         private string nom;
 
+        /// <summary>
+        /// Retourne idservice
+        /// </summary>
         public int Idservice { get => idservice; }
+        /// <summary>
+        /// Retourne nom
+        /// </summary>
         public string Nom { get => nom; }
 
         /// <summary>
diff --git a/MediaTek86/vue/GererAbsence.cs b/MediaTek86/vue/GererAbsence.cs
index 4b773e1..1fa0073 100644
--- a/MediaTek86/vue/GererAbsence.cs
+++ b/MediaTek86/vue/GererAbsence.cs
@@ -34,8 +34,6 @@ namespace MediaTek86.vue
         /// </summary>
         private Controle controle;
 
-        public frmModificationAbsence frmModificationAbsence;
-
         /// <summary>
         /// Permet de changer la valeur de idpersonnel
         /// </summary>
diff --git a/MediaTek86/vue/ListePersonnel.cs b/MediaTek86/vue/ListePersonnel.cs
index 2278ba0..665259c 100644
--- a/MediaTek86/vue/ListePersonnel.cs
+++ b/MediaTek86/vue/ListePersonnel.cs
@@ -26,6 +26,12 @@ namespace MediaTek86.vue
         /// Objet pour gérer la liste des profils
         /// </summary>
         public BindingSource bdgService = new BindingSource();
+
+        /// <summary>
+        /// Initialisation des composants graphiques
+        /// Récupération du controleur
+        /// </summary>
+        /// <param name="controle"></param>
         public frmListePersonnel(Controle controle)
         {
             InitializeComponent();
-- 
2.49.0.windows.1

