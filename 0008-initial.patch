From 75e876f5ac94d1f66200c218c3cd9249475cde33 Mon Sep 17 00:00:00 2001
From: florent Richard <florent.r08@live.fr>
Date: Wed, 21 Apr 2021 12:17:11 +0200
Subject: [PATCH] =?UTF-8?q?Ajout=20de=20la=20fonctionnalit=C3=A9=20pour=20?=
 =?UTF-8?q?acc=C3=A9der=20aux=20absences=20d'un=20personnel?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 MediaTek86/controle/Controle.cs               | 115 +++++++++++++--
 MediaTek86/dal/AccesDonnees.cs                |  44 ++++++
 MediaTek86/modele/Absence.cs                  |  25 +++-
 MediaTek86/modele/Motif.cs                    |  12 ++
 MediaTek86/vue/GererAbsence.Designer.cs       |  89 ++++++++++--
 MediaTek86/vue/GererAbsence.cs                | 137 +++++++++++++++++-
 MediaTek86/vue/ListePersonnel.Designer.cs     |   1 +
 MediaTek86/vue/ListePersonnel.cs              |  67 +++++----
 .../vue/ModificationPersonnel.Designer.cs     |   4 -
 MediaTek86/vue/ModificationPersonnel.cs       |  14 +-
 10 files changed, 425 insertions(+), 83 deletions(-)

diff --git a/MediaTek86/controle/Controle.cs b/MediaTek86/controle/Controle.cs
index 7976b22..628f5f6 100644
--- a/MediaTek86/controle/Controle.cs
+++ b/MediaTek86/controle/Controle.cs
@@ -6,6 +6,7 @@ using System.Collections.Generic;
 using System.Linq;
 using System.Text;
 using System.Threading.Tasks;
+using System.Windows.Forms;
 
 namespace MediaTek86.controle
 {
@@ -15,10 +16,20 @@ namespace MediaTek86.controle
     public class Controle
     {
         /// <summary>
-        /// fenêtre d'authentification
+        /// instance de frmListePersonnel
         /// </summary>
         private frmListePersonnel frmListePersonnel;
 
+        /// <summary>
+        /// instance de frmModificationPersonnel
+        /// </summary>
+        private frmModificationPersonnel frmModificationPersonnel;
+
+        /// <summary>
+        /// instance de frmGererAbsence
+        /// </summary>
+        private frmGererAbsence frmGererAbsence;
+
         /// <summary>
         /// Ouverture de la fenêtre
         /// </summary>
@@ -31,46 +42,120 @@ namespace MediaTek86.controle
         /// <summary>
         /// Récupère et retourne les infos du personnel provenant de la BDD
         /// </summary>
-        /// <returns>liste du personnel</returns>
-        public List<Personnel> GetLesPersonnels()
+        /// <param name="bdgListe"></param>
+        public void GetLesPersonnels(BindingSource bdgListe)
         {
-            return AccesDonnees.GetLesPersonnels();
+            List<Personnel> lesPersonnels = AccesDonnees.GetLesPersonnels();
+            bdgListe.DataSource = lesPersonnels;
         }
 
         /// <summary>
         /// Récupère et retourne les infos des services provenant de la BDD
         /// </summary>
-        /// <returns>liste des services</returns>
-        public List<Service> GetLesServices()
+        /// <param name="bdgListe"></param>
+        public void GetLesServices(BindingSource bdgListe)
         {
-            return AccesDonnees.GetLesServices();
+            List<Service> lesServices = AccesDonnees.GetLesServices();
+            bdgListe.DataSource = lesServices;
         }
 
         /// <summary>
-        /// Demande d'ajout d'un personnel
+        /// Récupère et retourne les infos des motifs provenant de la BDD
+        /// </summary>
+        /// <param name="bdgListe"></param>
+        public void GetLesMotifs(BindingSource bdgListe)
+        {
+            List<Motif> lesMotifs = AccesDonnees.GetLesMotifs();
+            bdgListe.DataSource = lesMotifs;
+        }
+
+        /// <summary>
+        /// Récupère et retourne les infos des absences provenant de la BDD
         /// </summary>
         /// <param name="personnel"></param>
-        public void AddDeveloppeur(Personnel personnel)
+        /// <param name="bdgListe"></param>
+        public void GetLesAbsences(Personnel personnel, BindingSource bdgListe)
+        {
+            List<Absence> lesAbsences = AccesDonnees.GetLesAbsences(personnel);
+            bdgListe.DataSource = lesAbsences;
+        }
+
+        /// <summary>
+        /// Demande pour accéder aux absences d'un personnel
+        /// </summary>
+        public void DemGererAbsence()
+        {
+            Personnel personnel = (Personnel)frmListePersonnel.bdgPersonnel.List[frmListePersonnel.bdgPersonnel.Position];
+            frmListePersonnel.Hide();
+            frmGererAbsence = new frmGererAbsence(this);
+            frmGererAbsence.RemplirListeAbsence(personnel);
+            frmGererAbsence.SetNom(personnel.Nom);
+            frmGererAbsence.SetPrenom(personnel.Prenom);
+            frmGererAbsence.SetIdPersonnel(personnel.Idpersonnel);
+            frmGererAbsence.ShowDialog();
+        }
+
+        /// <summary>
+        /// Demande d'ajout d'un personnel
+        /// </summary>
+        /// <param name="nom"></param>
+        /// <param name="prenom"></param>
+        /// <param name="tel"></param>
+        /// <param name="mail"></param>
+        public void AddDeveloppeur(string nom, string prenom, string tel, string mail)
         {
+            Service service = (Service)frmListePersonnel.bdgService.List[frmListePersonnel.bdgService.Position];
+            int idpersonnel = 0;
+            Personnel personnel = new Personnel(idpersonnel, nom, prenom, tel, mail, service.Idservice, service.Nom);
             AccesDonnees.AddPersonnel(personnel);
         }
 
         /// <summary>
         /// Demande de suppression d'un personnel
         /// </summary>
-        /// <param name="personnel"></param>
-        public void DelPersonnel(Personnel personnel)
+        public void DelPersonnel()
         {
-            AccesDonnees.DelPersonnel(personnel);
+            Personnel personnel = (Personnel)frmListePersonnel.bdgPersonnel.List[frmListePersonnel.bdgPersonnel.Position];
+            if (MessageBox.Show("Voulez-vous vraiment supprimer " + personnel.Nom + " " + personnel.Prenom + " ?", "Confirmation de suppression", MessageBoxButtons.YesNo) == DialogResult.Yes)
+            {
+                AccesDonnees.DelPersonnel(personnel);
+            }
         }
 
         /// <summary>
-        /// Demande de modification d'un personnel
+        /// Demande pour acceder à la modification d'un personnel
         /// </summary>
-        /// <param name="personnel"></param>
-        public void UpdatePersonnel(Personnel personnel)
+        public void DemUpdatePersonnel()
+        {
+            // Ferme la fenêtre ouverte
+            frmListePersonnel.Hide();
+            frmModificationPersonnel = new frmModificationPersonnel(this);
+            Personnel personnel = (Personnel)frmListePersonnel.bdgPersonnel.List[frmListePersonnel.bdgPersonnel.Position];
+            frmModificationPersonnel.idpersonnel = personnel.Idpersonnel;
+            frmModificationPersonnel.nom = personnel.Nom;
+            frmModificationPersonnel.prenom = personnel.Prenom;
+            frmModificationPersonnel.tel = personnel.Tel;
+            frmModificationPersonnel.mail = personnel.Mail;
+            frmModificationPersonnel.service = personnel.Service;
+            // Ouvre la fenêtre frmModificationPersonnel
+            frmModificationPersonnel.ShowDialog();
+        }
+
+        /// <summary>
+        /// Enregistre les modifications d'un personnel
+        /// </summary>
+        /// <param name="nom"></param>
+        /// <param name="prenom"></param>
+        /// <param name="tel"></param>
+        /// <param name="mail"></param>
+        public void EnrUpdatePersonnel(string nom, string prenom, string tel, string mail)
         {
+            Service service = (Service)frmModificationPersonnel.bdgService.List[frmModificationPersonnel.bdgService.Position];
+            Personnel personnel = new Personnel(frmModificationPersonnel.idpersonnel, nom, prenom, tel, mail, service.Idservice, service.Nom);
             AccesDonnees.UpdatePersonnel(personnel);
+            frmModificationPersonnel.Hide();
+            frmListePersonnel = new frmListePersonnel(this);
+            frmListePersonnel.ShowDialog();
         }
     }
 }
diff --git a/MediaTek86/dal/AccesDonnees.cs b/MediaTek86/dal/AccesDonnees.cs
index 76ac559..65c546e 100644
--- a/MediaTek86/dal/AccesDonnees.cs
+++ b/MediaTek86/dal/AccesDonnees.cs
@@ -56,6 +56,50 @@ namespace MediaTek86.dal
             return lesServices;
         }
 
+        /// <summary>
+        /// Récupère et retourne les absences d'un personnel provenant de la BDD
+        /// </summary>
+        /// <param name="personnel"></param>
+        /// <returns></returns>
+        public static List<Absence> GetLesAbsences(Personnel personnel)
+        {
+            List<Absence> lesAbsences = new List<Absence>();
+            string req = "select p.idpersonnel, p.nom as nom, p.prenom as prenom, a.datedebut as datedebut, a.datefin as datefin, m.libelle as motif, m.idmotif as idmotif ";
+            req += "from personnel p JOIN absence a ON p.idpersonnel = a.idpersonnel JOIN motif m ON a.idmotif = m.idmotif ";
+            req += "where p.idpersonnel = @idpersonnel ";
+            req += "order by datedebut desc";
+            Dictionary<string, object> parameters = new Dictionary<string, object>();
+            parameters.Add("@idpersonnel", personnel.Idpersonnel);
+            ConnexionBDD curs = ConnexionBDD.GetInstance(connectionString);
+            curs.ReqSelect(req, parameters);
+            while (curs.Read())
+            {
+                Absence absence = new Absence((int)curs.Field("idpersonnel"), (string)curs.Field("nom"), (string)curs.Field("prenom"), (DateTime)curs.Field("datedebut"), (DateTime)curs.Field("datefin"), (int)curs.Field("idmotif"), (string)curs.Field("motif"));
+                lesAbsences.Add(absence);
+            }
+            curs.Close();
+            return lesAbsences;
+        }
+
+        /// <summary>
+        /// Récupère et retourne les motifs provenant de la BDD
+        /// </summary>
+        /// <returns></returns>
+        public static List<Motif> GetLesMotifs()
+        {
+            List<Motif> lesMotifs = new List<Motif>();
+            string req = "select * from motif order by libelle";
+            ConnexionBDD curs = ConnexionBDD.GetInstance(connectionString);
+            curs.ReqSelect(req, null);
+            while (curs.Read())
+            {
+                Motif motif = new Motif((int)curs.Field("idmotif"), (string)curs.Field("libelle"));
+                lesMotifs.Add(motif);
+            }
+            curs.Close();
+            return lesMotifs;
+        }
+
         /// <summary>
         /// Ajoute un personnel
         /// </summary>
diff --git a/MediaTek86/modele/Absence.cs b/MediaTek86/modele/Absence.cs
index 7541e12..c32341f 100644
--- a/MediaTek86/modele/Absence.cs
+++ b/MediaTek86/modele/Absence.cs
@@ -5,7 +5,7 @@ using System.Text;
 using System.Threading.Tasks;
 
 namespace MediaTek86.modele
-{   
+{
     /// <summary>
     /// Création d'une absence
     /// </summary>
@@ -13,23 +13,40 @@ namespace MediaTek86.modele
     {
         // Déclaration des propriétés
         private int idpersonnel;
-        private string datedebut;
-        private string datefin;
+        private string nom;
+        private string prenom;
+        private DateTime datedebut;
+        private DateTime datefin;
         private int idmotif;
+        private string motif;
+
+        public int Idpersonnel { get => idpersonnel; }
+        public string Nom { get => nom; }
+        public string Prenom { get => prenom; }
+        public DateTime Date_de_debut { get => datedebut; }
+        public DateTime Date_de_fin { get => datefin; }
+        public int Idmotif { get => idmotif; }
+        public string Motif { get => motif; }
 
         /// <summary>
         /// Constructeur : valorise les propriétés
         /// </summary>
         /// <param name="idpersonnel"></param>
+        /// <param name="nom"></param>
+        /// <param name="prenom"></param>
         /// <param name="datedebut"></param>
         /// <param name="datefin"></param>
         /// <param name="idmotif"></param>
-        public Absence(int idpersonnel, string datedebut, string datefin, int idmotif)
+        /// <param name="motif"></param>
+        public Absence(int idpersonnel, string nom, string prenom, DateTime datedebut, DateTime datefin, int idmotif, string motif)
         {
             this.idpersonnel = idpersonnel;
+            this.nom = nom;
+            this.prenom = prenom;
             this.datedebut = datedebut;
             this.datefin = datefin;
             this.idmotif = idmotif;
+            this.motif = motif;
         }
     }
 }
diff --git a/MediaTek86/modele/Motif.cs b/MediaTek86/modele/Motif.cs
index c3d33d1..f1a9cfc 100644
--- a/MediaTek86/modele/Motif.cs
+++ b/MediaTek86/modele/Motif.cs
@@ -15,6 +15,9 @@ namespace MediaTek86.modele
         private int idmotif;
         private string libelle;
 
+        public int Idmotif { get => idmotif; }
+        public string Libelle { get => libelle; }
+
         /// <summary>
         /// Constructeur : valorise les propriétés
         /// </summary>
@@ -25,5 +28,14 @@ namespace MediaTek86.modele
             this.idmotif = idmotif;
             this.libelle = libelle;
         }
+
+        /// <summary>
+        /// Définit l'information à afficher (juste le libelle)
+        /// </summary>
+        /// <returns></returns>
+        public override string ToString()
+        {
+            return this.libelle;
+        }
     }
 }
diff --git a/MediaTek86/vue/GererAbsence.Designer.cs b/MediaTek86/vue/GererAbsence.Designer.cs
index 112f3f2..c131706 100644
--- a/MediaTek86/vue/GererAbsence.Designer.cs
+++ b/MediaTek86/vue/GererAbsence.Designer.cs
@@ -28,6 +28,7 @@
         /// </summary>
         private void InitializeComponent()
         {
+            System.Windows.Forms.DataGridViewCellStyle dataGridViewCellStyle1 = new System.Windows.Forms.DataGridViewCellStyle();
             this.btnAjouterAbsence = new System.Windows.Forms.Button();
             this.cbbMotif = new System.Windows.Forms.ComboBox();
             this.txtDateDebut = new System.Windows.Forms.TextBox();
@@ -38,7 +39,12 @@
             this.btnRetourListePerso = new System.Windows.Forms.Button();
             this.btnModifAbsence = new System.Windows.Forms.Button();
             this.btnSupAbsence = new System.Windows.Forms.Button();
-            this.lstLAbsence = new System.Windows.Forms.ListBox();
+            this.dgvAbsence = new System.Windows.Forms.DataGridView();
+            this.lblNom = new System.Windows.Forms.Label();
+            this.txtNom = new System.Windows.Forms.TextBox();
+            this.lblPrenom = new System.Windows.Forms.Label();
+            this.txtPrenom = new System.Windows.Forms.TextBox();
+            ((System.ComponentModel.ISupportInitialize)(this.dgvAbsence)).BeginInit();
             this.SuspendLayout();
             // 
             // btnAjouterAbsence
@@ -54,11 +60,6 @@
             // 
             this.cbbMotif.Font = new System.Drawing.Font("Microsoft Sans Serif", 11.25F);
             this.cbbMotif.FormattingEnabled = true;
-            this.cbbMotif.Items.AddRange(new object[] {
-            "Vacances",
-            "Maladie",
-            "Motif familial",
-            "Conge parental"});
             this.cbbMotif.Location = new System.Drawing.Point(152, 419);
             this.cbbMotif.Name = "cbbMotif";
             this.cbbMotif.Size = new System.Drawing.Size(152, 26);
@@ -137,19 +138,72 @@
             this.btnSupAbsence.Text = "Supprimer l\'absence";
             this.btnSupAbsence.UseVisualStyleBackColor = true;
             // 
-            // lstLAbsence
-            // 
-            this.lstLAbsence.FormattingEnabled = true;
-            this.lstLAbsence.Location = new System.Drawing.Point(31, 28);
-            this.lstLAbsence.Name = "lstLAbsence";
-            this.lstLAbsence.Size = new System.Drawing.Size(707, 277);
-            this.lstLAbsence.TabIndex = 15;
+            // dgvAbsence
+            // 
+            this.dgvAbsence.AllowUserToAddRows = false;
+            this.dgvAbsence.AllowUserToDeleteRows = false;
+            dataGridViewCellStyle1.Alignment = System.Windows.Forms.DataGridViewContentAlignment.MiddleLeft;
+            dataGridViewCellStyle1.BackColor = System.Drawing.SystemColors.Control;
+            dataGridViewCellStyle1.Font = new System.Drawing.Font("Microsoft Sans Serif", 11.25F);
+            dataGridViewCellStyle1.ForeColor = System.Drawing.SystemColors.WindowText;
+            dataGridViewCellStyle1.SelectionBackColor = System.Drawing.SystemColors.Highlight;
+            dataGridViewCellStyle1.SelectionForeColor = System.Drawing.SystemColors.HighlightText;
+            dataGridViewCellStyle1.WrapMode = System.Windows.Forms.DataGridViewTriState.True;
+            this.dgvAbsence.ColumnHeadersDefaultCellStyle = dataGridViewCellStyle1;
+            this.dgvAbsence.ColumnHeadersHeightSizeMode = System.Windows.Forms.DataGridViewColumnHeadersHeightSizeMode.AutoSize;
+            this.dgvAbsence.Location = new System.Drawing.Point(32, 33);
+            this.dgvAbsence.Name = "dgvAbsence";
+            this.dgvAbsence.ReadOnly = true;
+            this.dgvAbsence.RowHeadersWidthSizeMode = System.Windows.Forms.DataGridViewRowHeadersWidthSizeMode.AutoSizeToAllHeaders;
+            this.dgvAbsence.Size = new System.Drawing.Size(706, 276);
+            this.dgvAbsence.TabIndex = 30;
+            // 
+            // lblNom
+            // 
+            this.lblNom.AutoSize = true;
+            this.lblNom.Font = new System.Drawing.Font("Tahoma", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, ((byte)(0)));
+            this.lblNom.Location = new System.Drawing.Point(28, 9);
+            this.lblNom.Name = "lblNom";
+            this.lblNom.Size = new System.Drawing.Size(54, 19);
+            this.lblNom.TabIndex = 31;
+            this.lblNom.Text = "Nom :";
+            // 
+            // txtNom
+            // 
+            this.txtNom.Font = new System.Drawing.Font("Microsoft Sans Serif", 11.25F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, ((byte)(0)));
+            this.txtNom.Location = new System.Drawing.Point(88, 7);
+            this.txtNom.Name = "txtNom";
+            this.txtNom.Size = new System.Drawing.Size(113, 24);
+            this.txtNom.TabIndex = 32;
+            // 
+            // lblPrenom
+            // 
+            this.lblPrenom.AutoSize = true;
+            this.lblPrenom.Font = new System.Drawing.Font("Tahoma", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, ((byte)(0)));
+            this.lblPrenom.Location = new System.Drawing.Point(250, 9);
+            this.lblPrenom.Name = "lblPrenom";
+            this.lblPrenom.Size = new System.Drawing.Size(75, 19);
+            this.lblPrenom.TabIndex = 33;
+            this.lblPrenom.Text = "Prenom :";
+            // 
+            // txtPrenom
+            // 
+            this.txtPrenom.Font = new System.Drawing.Font("Microsoft Sans Serif", 11.25F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, ((byte)(0)));
+            this.txtPrenom.Location = new System.Drawing.Point(331, 7);
+            this.txtPrenom.Name = "txtPrenom";
+            this.txtPrenom.Size = new System.Drawing.Size(113, 24);
+            this.txtPrenom.TabIndex = 34;
             // 
             // frmGererAbsence
             // 
             this.AutoScaleDimensions = new System.Drawing.SizeF(6F, 13F);
             this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
             this.ClientSize = new System.Drawing.Size(764, 506);
+            this.Controls.Add(this.txtPrenom);
+            this.Controls.Add(this.lblPrenom);
+            this.Controls.Add(this.txtNom);
+            this.Controls.Add(this.lblNom);
+            this.Controls.Add(this.dgvAbsence);
             this.Controls.Add(this.btnAjouterAbsence);
             this.Controls.Add(this.cbbMotif);
             this.Controls.Add(this.txtDateDebut);
@@ -160,9 +214,10 @@
             this.Controls.Add(this.btnRetourListePerso);
             this.Controls.Add(this.btnModifAbsence);
             this.Controls.Add(this.btnSupAbsence);
-            this.Controls.Add(this.lstLAbsence);
             this.Name = "frmGererAbsence";
             this.Text = "Absence";
+            this.Load += new System.EventHandler(this.frmGererAbsence_Load);
+            ((System.ComponentModel.ISupportInitialize)(this.dgvAbsence)).EndInit();
             this.ResumeLayout(false);
             this.PerformLayout();
 
@@ -180,6 +235,10 @@
         private System.Windows.Forms.Button btnRetourListePerso;
         private System.Windows.Forms.Button btnModifAbsence;
         private System.Windows.Forms.Button btnSupAbsence;
-        private System.Windows.Forms.ListBox lstLAbsence;
+        private System.Windows.Forms.DataGridView dgvAbsence;
+        private System.Windows.Forms.Label lblNom;
+        private System.Windows.Forms.TextBox txtNom;
+        private System.Windows.Forms.Label lblPrenom;
+        private System.Windows.Forms.TextBox txtPrenom;
     }
 }
\ No newline at end of file
diff --git a/MediaTek86/vue/GererAbsence.cs b/MediaTek86/vue/GererAbsence.cs
index 8662533..e5c73c4 100644
--- a/MediaTek86/vue/GererAbsence.cs
+++ b/MediaTek86/vue/GererAbsence.cs
@@ -1,4 +1,6 @@
-﻿using System;
+﻿using MediaTek86.controle;
+using MediaTek86.modele;
+using System;
 using System.Collections.Generic;
 using System.ComponentModel;
 using System.Data;
@@ -12,13 +14,144 @@ namespace MediaTek86.vue
 {
     public partial class frmGererAbsence : Form
     {
+        // Déclaration des propriétés
+        private int idpersonnel;
+        private int idmotif;
+        private string nom;
+        private string prenom;
+
+        /// <summary>
+        /// Objet pour gérer la liste des absences
+        /// </summary>
+        public BindingSource bdgAbsence = new BindingSource();
+        /// <summary>
+        /// Objet pour gérer la liste des absences
+        /// </summary>
+        public BindingSource bdgMotif = new BindingSource();
+
+        /// <summary>
+        /// instance du controleur
+        /// </summary>
+        private Controle controle;
+
+        /// <summary>
+        /// Permet de changer la valeur de idpersonnel
+        /// </summary>
+        /// <param name="idpersonnel"></param>
+        public void SetIdPersonnel(int idpersonnel)
+        {
+            this.idpersonnel = idpersonnel;
+        }
+        /// <summary>
+        /// Permet de changer la valeur de idmotif
+        /// </summary>
+        /// <param name="idmotif"></param>
+        public void SetIdMotif(int idmotif)
+        {
+            this.idmotif = idmotif;
+        }
+        /// <summary>
+        /// Permet de changer la valeur du nom
+        /// </summary>
+        /// <param name="nom"></param>
+        public void SetNom(string nom)
+        {
+            this.nom = nom;
+        }
+        /// <summary>
+        /// Permet de changer la valeur du prenom
+        /// </summary>
+        /// <param name="prenom"></param>
+        public void SetPrenom(string prenom)
+        {
+            this.prenom = prenom;
+        }
+        /// <summary>
+        /// Retourne idpersonnel
+        /// </summary>
+        /// <returns></returns>
+        public int GetIdPersonnel()
+        {
+            return idpersonnel;
+        }
+        /// <summary>
+        /// Retourne idmotif
+        /// </summary>
+        /// <returns></returns>
+        public int GetIdMotif()
+        {
+            return idmotif;
+        }
+        /// <summary>
+        /// Retourne nom
+        /// </summary>
+        /// <returns></returns>
+        public string GetNom()
+        {
+            return nom;
+        }
+        /// <summary>
+        /// Retourne prenom
+        /// </summary>
+        /// <returns></returns>
+        public string GetPrenom()
+        {
+            return prenom;
+        }
+
         /// <summary>
         /// Initialisation des composants graphiques
         /// Récupération du controleur
         /// </summary>
-        public frmGererAbsence()
+        public frmGererAbsence(Controle controle)
         {
             InitializeComponent();
+            this.controle = controle;
+            Init();
+        }
+
+        /// <summary>
+        /// Initialisation de la frame : remplissage des listes
+        /// </summary>
+        public void Init()
+        {
+            RemplirListeMotif();
+            txtNom.Enabled = false;
+            txtPrenom.Enabled = false;
+        }
+
+        private void frmGererAbsence_Load(object sender, EventArgs e)
+        {
+            txtNom.Text = GetNom();
+            txtPrenom.Text = GetPrenom();
         }
+
+        /// <summary>
+        /// Affiche les motifs
+        /// </summary>
+        public void RemplirListeMotif()
+        {
+            controle.GetLesMotifs(bdgMotif);
+            cbbMotif.DataSource = bdgMotif;
+            if (cbbMotif.Items.Count > 0)
+            {
+                cbbMotif.SelectedIndex = 0;
+            }
+        }
+
+        /// <summary>
+        /// Affiche les absences
+        /// </summary>
+        public void RemplirListeAbsence(Personnel personnel)
+        {
+            controle.GetLesAbsences(personnel, bdgAbsence);
+            dgvAbsence.DataSource = bdgAbsence;
+            dgvAbsence.Columns["idmotif"].Visible = false;
+            dgvAbsence.Columns["idpersonnel"].Visible = false;
+            dgvAbsence.Columns["nom"].Visible = false;
+            dgvAbsence.Columns["prenom"].Visible = false;
+            dgvAbsence.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.AllCells;
+        }
+
     }
 }
diff --git a/MediaTek86/vue/ListePersonnel.Designer.cs b/MediaTek86/vue/ListePersonnel.Designer.cs
index d29b890..efbdb12 100644
--- a/MediaTek86/vue/ListePersonnel.Designer.cs
+++ b/MediaTek86/vue/ListePersonnel.Designer.cs
@@ -77,6 +77,7 @@
             this.btnGererAbsence.TabIndex = 3;
             this.btnGererAbsence.Text = "Gérer les absences";
             this.btnGererAbsence.UseVisualStyleBackColor = true;
+            this.btnGererAbsence.Click += new System.EventHandler(this.btnGererAbsence_Click);
             // 
             // lblNom
             // 
diff --git a/MediaTek86/vue/ListePersonnel.cs b/MediaTek86/vue/ListePersonnel.cs
index 3bffb5c..bfa65d9 100644
--- a/MediaTek86/vue/ListePersonnel.cs
+++ b/MediaTek86/vue/ListePersonnel.cs
@@ -7,7 +7,6 @@ using System.Linq;
 using System.Text;
 using System.Threading.Tasks;
 using System.Windows.Forms;
-using MediaTek86.modele;
 using MediaTek86.controle;
 
 namespace MediaTek86.vue
@@ -19,7 +18,10 @@ namespace MediaTek86.vue
         /// </summary>
         private Controle controle;
 
-        private frmModificationPersonnel frmModificationPersonnel;
+        /// <summary>
+        /// instance de frmGererAbsence
+        /// </summary>
+        public frmGererAbsence frmGererAbsence;
 
         /// <summary>
         /// Objet pour gérer la liste du personnel
@@ -65,7 +67,6 @@ namespace MediaTek86.vue
             txtPrenom.Text = "";
             txtTel.Text = "";
             txtMail.Text = "";
-
         }
 
         /// <summary>
@@ -79,12 +80,11 @@ namespace MediaTek86.vue
         }
 
         /// <summary>
-        /// Affiche le personnel
+        /// Remplis et affiche le personnel
         /// </summary>
         public void RemplirListePersonnel()
         {
-            List<Personnel> lesPersonnels = controle.GetLesPersonnels();
-            bdgPersonnel.DataSource = lesPersonnels;
+            controle.GetLesPersonnels(bdgPersonnel);
             dgvPersonnel.DataSource = bdgPersonnel;
             dgvPersonnel.Columns["idpersonnel"].Visible = false;
             dgvPersonnel.Columns["idservice"].Visible = false;
@@ -92,12 +92,11 @@ namespace MediaTek86.vue
         }
 
         /// <summary>
-        /// Affiche les services
+        /// Remplis et affiche les services
         /// </summary>
         public void RemplirListeService()
         {
-            List<Service> lesServices = controle.GetLesServices();
-            bdgService.DataSource = lesServices;
+            controle.GetLesServices(bdgService);
             cbbService.DataSource = bdgService;
             if (cbbService.Items.Count > 0)
             {
@@ -105,6 +104,11 @@ namespace MediaTek86.vue
             }
         }
 
+        /// <summary>
+        /// Affiche les zones de textes pour ajouter un personnel
+        /// </summary>
+        /// <param name="sender"></param>
+        /// <param name="e"></param>
         private void btnAjouterPersonnel_Click(object sender, EventArgs e)
         {
             GererZoneTexte(true);
@@ -130,10 +134,7 @@ namespace MediaTek86.vue
         {
             if (!txtNom.Text.Equals("") && !txtPrenom.Text.Equals("") && !txtTel.Text.Equals("") && !txtMail.Text.Equals("") && cbbService.SelectedIndex != -1)
             {
-                Service service = (Service)bdgService.List[bdgService.Position];
-                int idpersonnel = 0;
-                Personnel personnel = new Personnel(idpersonnel, txtNom.Text, txtPrenom.Text, txtTel.Text, txtMail.Text, service.Idservice, service.Nom);
-                controle.AddDeveloppeur(personnel);
+                controle.AddDeveloppeur(txtNom.Text, txtPrenom.Text, txtTel.Text, txtMail.Text);
                 RemplirListePersonnel();
                 ViderZoneTexte();
             }
@@ -152,12 +153,8 @@ namespace MediaTek86.vue
         {
             if (dgvPersonnel.SelectedRows.Count > 0)
             {
-                Personnel personnel = (Personnel)bdgPersonnel.List[bdgPersonnel.Position];
-                if (MessageBox.Show("Voulez-vous vraiment supprimer " + personnel.Nom + " " + personnel.Prenom + " ?", "Confirmation de suppression", MessageBoxButtons.YesNo) == DialogResult.Yes)
-                {
-                    controle.DelPersonnel(personnel);
-                    RemplirListePersonnel();
-                }
+                controle.DelPersonnel();
+                RemplirListePersonnel();
             }
             else
             {
@@ -166,7 +163,7 @@ namespace MediaTek86.vue
         }
 
         /// <summary>
-        /// Affiche la fenêtre pour modifier un personnel
+        /// Bouton pour demander la modification d'un personnel
         /// </summary>
         /// <param name="sender"></param>
         /// <param name="e"></param>
@@ -174,18 +171,24 @@ namespace MediaTek86.vue
         {
             if (dgvPersonnel.SelectedRows.Count > 0)
             {
-                // Ferme la fenêtre active
-                this.Hide();
-                frmModificationPersonnel = new frmModificationPersonnel(controle);
-                Personnel personnel = (Personnel)bdgPersonnel.List[bdgPersonnel.Position];
-                frmModificationPersonnel.idpersonnel = personnel.Idpersonnel;
-                frmModificationPersonnel.nom = personnel.Nom;
-                frmModificationPersonnel.prenom = personnel.Prenom;
-                frmModificationPersonnel.tel = personnel.Tel;
-                frmModificationPersonnel.mail = personnel.Mail;
-                frmModificationPersonnel.service = personnel.Service;
-                // Ouvre la fenêtre frmModificationPersonnel
-                frmModificationPersonnel.ShowDialog();
+                controle.DemUpdatePersonnel();
+            }
+            else
+            {
+                MessageBox.Show("Une ligne doit être sélectionnée.", "Information");
+            }
+        }
+
+        /// <summary>
+        /// Ouvre la fenêtre de gestion des absences du personnel sélectionné
+        /// </summary>
+        /// <param name="sender"></param>
+        /// <param name="e"></param>
+        private void btnGererAbsence_Click(object sender, EventArgs e)
+        {
+            if (dgvPersonnel.SelectedRows.Count > 0)
+            {
+                controle.DemGererAbsence();
             }
             else
             {
diff --git a/MediaTek86/vue/ModificationPersonnel.Designer.cs b/MediaTek86/vue/ModificationPersonnel.Designer.cs
index 71ba1dc..caa55d3 100644
--- a/MediaTek86/vue/ModificationPersonnel.Designer.cs
+++ b/MediaTek86/vue/ModificationPersonnel.Designer.cs
@@ -67,10 +67,6 @@
             // 
             this.cbbService.Font = new System.Drawing.Font("Microsoft Sans Serif", 11.25F);
             this.cbbService.FormattingEnabled = true;
-            this.cbbService.Items.AddRange(new object[] {
-            "Administratif",
-            "Mediation Culturelle",
-            "Pret"});
             this.cbbService.Location = new System.Drawing.Point(398, 70);
             this.cbbService.Name = "cbbService";
             this.cbbService.Size = new System.Drawing.Size(152, 26);
diff --git a/MediaTek86/vue/ModificationPersonnel.cs b/MediaTek86/vue/ModificationPersonnel.cs
index 6553429..1c17bb2 100644
--- a/MediaTek86/vue/ModificationPersonnel.cs
+++ b/MediaTek86/vue/ModificationPersonnel.cs
@@ -1,5 +1,4 @@
 ﻿using MediaTek86.controle;
-using MediaTek86.modele;
 using System;
 using System.Collections.Generic;
 using System.ComponentModel;
@@ -31,7 +30,7 @@ namespace MediaTek86.vue
         /// <summary>
         /// Objet pour gérer la liste des profils
         /// </summary>
-        BindingSource bdgService = new BindingSource();
+        public BindingSource bdgService = new BindingSource();
 
         /// <summary>
         /// Initialisation des composants graphiques
@@ -57,8 +56,7 @@ namespace MediaTek86.vue
         /// </summary>
         public void RemplirListeService()
         {
-            List<Service> lesServices = controle.GetLesServices();
-            bdgService.DataSource = lesServices;
+            controle.GetLesServices(bdgService);
             cbbService.DataSource = bdgService;
             if (cbbService.Items.Count > 0)
             {
@@ -103,13 +101,7 @@ namespace MediaTek86.vue
             {
                 if (MessageBox.Show("Voulez-vous vraiment enregistrer ?", "Confirmation d'enregistrement", MessageBoxButtons.YesNo) == DialogResult.Yes)
                 {
-                    Service service = (Service)bdgService.List[bdgService.Position];
-                    Personnel personnel = new Personnel(this.idpersonnel, txtNom.Text, txtPrenom.Text, txtTel.Text, txtMail.Text, service.Idservice, service.Nom);
-                    controle.UpdatePersonnel(personnel);
-                    Console.WriteLine(personnel.Idpersonnel);
-                    this.Hide();
-                    frmListePersonnel = new frmListePersonnel(controle);
-                    frmListePersonnel.ShowDialog();
+                    controle.EnrUpdatePersonnel(txtNom.Text, txtPrenom.Text, txtTel.Text, txtMail.Text);
                 }
                 
             }
-- 
2.49.0.windows.1

