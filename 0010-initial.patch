From 05b461e8dce7d5b1ab253206634911b8fe543a70 Mon Sep 17 00:00:00 2001
From: florent Richard <florent.r08@live.fr>
Date: Mon, 26 Apr 2021 11:21:35 +0200
Subject: [PATCH] =?UTF-8?q?Ajout=20de=20la=20fonctionnalit=C3=A9=20pour=20?=
 =?UTF-8?q?ajouter=20une=20absence?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 MediaTek86/controle/Controle.cs         | 14 ++++
 MediaTek86/dal/AccesDonnees.cs          | 17 +++++
 MediaTek86/vue/GererAbsence.Designer.cs | 97 ++++++++++++++++---------
 MediaTek86/vue/GererAbsence.cs          | 55 ++++++++++++++
 4 files changed, 147 insertions(+), 36 deletions(-)

diff --git a/MediaTek86/controle/Controle.cs b/MediaTek86/controle/Controle.cs
index faa731d..c2f6c9e 100644
--- a/MediaTek86/controle/Controle.cs
+++ b/MediaTek86/controle/Controle.cs
@@ -179,5 +179,19 @@ namespace MediaTek86.controle
             frmListePersonnel = new frmListePersonnel(this);
             frmListePersonnel.ShowDialog();
         }
+
+        /// <summary>
+        /// Demande d'ajout d'une absence
+        /// </summary>
+        /// <param name="absence"></param>
+        public void AddAbsence(int idpersonnel, string nom, string prenom, DateTime datedebut, DateTime datefin)
+        {
+            Console.WriteLine(frmGererAbsence.GetIdPersonnel());
+            Motif motif = (Motif)frmGererAbsence.bdgMotif.List[frmGererAbsence.bdgMotif.Position];
+            Personnel personnel = new Personnel(frmGererAbsence.GetIdPersonnel(), null, null, null, null, 0, null);
+            Absence absence = new Absence(idpersonnel, nom, prenom, datedebut, datefin, motif.Idmotif, motif.Libelle);
+            AccesDonnees.AddAbsence(absence);
+            frmGererAbsence.RemplirListeAbsence(personnel);
+        }
     }
 }
diff --git a/MediaTek86/dal/AccesDonnees.cs b/MediaTek86/dal/AccesDonnees.cs
index 65c546e..899dac1 100644
--- a/MediaTek86/dal/AccesDonnees.cs
+++ b/MediaTek86/dal/AccesDonnees.cs
@@ -150,6 +150,23 @@ namespace MediaTek86.dal
             conn.ReqUpdate(req, parameters);
         }
 
+        /// <summary>
+        /// Ajout d'une absence
+        /// </summary>
+        /// <param name="absence"></param>
+        public static void AddAbsence(Absence absence)
+        {
+            string req = "insert into absence(idpersonnel, datedebut, datefin, idmotif) ";
+            req += "values (@idpersonnel, @datedebut, @datefin, @idmotif);";
+            Dictionary<string, object> parameters = new Dictionary<string, object>();
+            parameters.Add("@idpersonnel", absence.Idpersonnel);
+            parameters.Add("@datedebut", absence.Date_de_debut);
+            parameters.Add("@datefin", absence.Date_de_fin);
+            parameters.Add("@idmotif", absence.Idmotif);
+            ConnexionBDD conn = ConnexionBDD.GetInstance(connectionString);
+            conn.ReqUpdate(req, parameters);
+        }
+
     }
 
 }
diff --git a/MediaTek86/vue/GererAbsence.Designer.cs b/MediaTek86/vue/GererAbsence.Designer.cs
index dd10a97..07a6b7a 100644
--- a/MediaTek86/vue/GererAbsence.Designer.cs
+++ b/MediaTek86/vue/GererAbsence.Designer.cs
@@ -29,10 +29,8 @@
         private void InitializeComponent()
         {
             System.Windows.Forms.DataGridViewCellStyle dataGridViewCellStyle1 = new System.Windows.Forms.DataGridViewCellStyle();
-            this.btnAjouterAbsence = new System.Windows.Forms.Button();
+            this.btnEnregistrerAbsence = new System.Windows.Forms.Button();
             this.cbbMotif = new System.Windows.Forms.ComboBox();
-            this.txtDateDebut = new System.Windows.Forms.TextBox();
-            this.txtDateFin = new System.Windows.Forms.TextBox();
             this.lblMotif = new System.Windows.Forms.Label();
             this.lblDateFin = new System.Windows.Forms.Label();
             this.lblDateDebut = new System.Windows.Forms.Label();
@@ -44,48 +42,37 @@
             this.txtNom = new System.Windows.Forms.TextBox();
             this.lblPrenom = new System.Windows.Forms.Label();
             this.txtPrenom = new System.Windows.Forms.TextBox();
+            this.dtpDateDebut = new System.Windows.Forms.DateTimePicker();
+            this.dtpDateFin = new System.Windows.Forms.DateTimePicker();
+            this.btnAjouterAbsence = new System.Windows.Forms.Button();
+            this.btnAnnulerAjout = new System.Windows.Forms.Button();
             ((System.ComponentModel.ISupportInitialize)(this.dgvAbsence)).BeginInit();
             this.SuspendLayout();
             // 
-            // btnAjouterAbsence
+            // btnEnregistrerAbsence
             // 
-            this.btnAjouterAbsence.Location = new System.Drawing.Point(152, 451);
-            this.btnAjouterAbsence.Name = "btnAjouterAbsence";
-            this.btnAjouterAbsence.Size = new System.Drawing.Size(182, 23);
-            this.btnAjouterAbsence.TabIndex = 29;
-            this.btnAjouterAbsence.Text = "Ajouter l\'absence";
-            this.btnAjouterAbsence.UseVisualStyleBackColor = true;
+            this.btnEnregistrerAbsence.Location = new System.Drawing.Point(31, 461);
+            this.btnEnregistrerAbsence.Name = "btnEnregistrerAbsence";
+            this.btnEnregistrerAbsence.Size = new System.Drawing.Size(182, 23);
+            this.btnEnregistrerAbsence.TabIndex = 29;
+            this.btnEnregistrerAbsence.Text = "Enregistrer l\'absence";
+            this.btnEnregistrerAbsence.UseVisualStyleBackColor = true;
+            this.btnEnregistrerAbsence.Click += new System.EventHandler(this.btnEnregistrerAbsence_Click);
             // 
             // cbbMotif
             // 
             this.cbbMotif.Font = new System.Drawing.Font("Microsoft Sans Serif", 11.25F);
             this.cbbMotif.FormattingEnabled = true;
-            this.cbbMotif.Location = new System.Drawing.Point(152, 419);
+            this.cbbMotif.Location = new System.Drawing.Point(152, 429);
             this.cbbMotif.Name = "cbbMotif";
             this.cbbMotif.Size = new System.Drawing.Size(152, 26);
             this.cbbMotif.TabIndex = 28;
             // 
-            // txtDateDebut
-            // 
-            this.txtDateDebut.Font = new System.Drawing.Font("Microsoft Sans Serif", 11.25F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, ((byte)(0)));
-            this.txtDateDebut.Location = new System.Drawing.Point(152, 359);
-            this.txtDateDebut.Name = "txtDateDebut";
-            this.txtDateDebut.Size = new System.Drawing.Size(113, 24);
-            this.txtDateDebut.TabIndex = 23;
-            // 
-            // txtDateFin
-            // 
-            this.txtDateFin.Font = new System.Drawing.Font("Microsoft Sans Serif", 11.25F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, ((byte)(0)));
-            this.txtDateFin.Location = new System.Drawing.Point(152, 387);
-            this.txtDateFin.Name = "txtDateFin";
-            this.txtDateFin.Size = new System.Drawing.Size(113, 24);
-            this.txtDateFin.TabIndex = 22;
-            // 
             // lblMotif
             // 
             this.lblMotif.AutoSize = true;
             this.lblMotif.Font = new System.Drawing.Font("Tahoma", 12F);
-            this.lblMotif.Location = new System.Drawing.Point(28, 419);
+            this.lblMotif.Location = new System.Drawing.Point(28, 429);
             this.lblMotif.Name = "lblMotif";
             this.lblMotif.Size = new System.Drawing.Size(55, 19);
             this.lblMotif.TabIndex = 21;
@@ -95,7 +82,7 @@
             // 
             this.lblDateFin.AutoSize = true;
             this.lblDateFin.Font = new System.Drawing.Font("Tahoma", 12F);
-            this.lblDateFin.Location = new System.Drawing.Point(27, 389);
+            this.lblDateFin.Location = new System.Drawing.Point(27, 399);
             this.lblDateFin.Name = "lblDateFin";
             this.lblDateFin.Size = new System.Drawing.Size(97, 19);
             this.lblDateFin.TabIndex = 20;
@@ -105,7 +92,7 @@
             // 
             this.lblDateDebut.AutoSize = true;
             this.lblDateDebut.Font = new System.Drawing.Font("Tahoma", 12F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, ((byte)(0)));
-            this.lblDateDebut.Location = new System.Drawing.Point(27, 359);
+            this.lblDateDebut.Location = new System.Drawing.Point(27, 369);
             this.lblDateDebut.Name = "lblDateDebut";
             this.lblDateDebut.Size = new System.Drawing.Size(119, 19);
             this.lblDateDebut.TabIndex = 19;
@@ -195,20 +182,56 @@
             this.txtPrenom.Size = new System.Drawing.Size(113, 24);
             this.txtPrenom.TabIndex = 34;
             // 
+            // dtpDateDebut
+            // 
+            this.dtpDateDebut.Location = new System.Drawing.Point(152, 369);
+            this.dtpDateDebut.Name = "dtpDateDebut";
+            this.dtpDateDebut.Size = new System.Drawing.Size(173, 20);
+            this.dtpDateDebut.TabIndex = 35;
+            // 
+            // dtpDateFin
+            // 
+            this.dtpDateFin.Location = new System.Drawing.Point(152, 403);
+            this.dtpDateFin.Name = "dtpDateFin";
+            this.dtpDateFin.Size = new System.Drawing.Size(173, 20);
+            this.dtpDateFin.TabIndex = 36;
+            // 
+            // btnAjouterAbsence
+            // 
+            this.btnAjouterAbsence.Location = new System.Drawing.Point(32, 344);
+            this.btnAjouterAbsence.Name = "btnAjouterAbsence";
+            this.btnAjouterAbsence.Size = new System.Drawing.Size(182, 23);
+            this.btnAjouterAbsence.TabIndex = 37;
+            this.btnAjouterAbsence.Text = "Ajouter une absence";
+            this.btnAjouterAbsence.UseVisualStyleBackColor = true;
+            this.btnAjouterAbsence.Click += new System.EventHandler(this.btnAjouterAbsence_Click_1);
+            // 
+            // btnAnnulerAjout
+            // 
+            this.btnAnnulerAjout.Location = new System.Drawing.Point(219, 461);
+            this.btnAnnulerAjout.Name = "btnAnnulerAjout";
+            this.btnAnnulerAjout.Size = new System.Drawing.Size(152, 23);
+            this.btnAnnulerAjout.TabIndex = 38;
+            this.btnAnnulerAjout.Text = "Annuler";
+            this.btnAnnulerAjout.UseVisualStyleBackColor = true;
+            this.btnAnnulerAjout.Click += new System.EventHandler(this.btnAnnulerAjout_Click);
+            // 
             // frmGererAbsence
             // 
             this.AutoScaleDimensions = new System.Drawing.SizeF(6F, 13F);
             this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
             this.ClientSize = new System.Drawing.Size(764, 506);
+            this.Controls.Add(this.btnAnnulerAjout);
+            this.Controls.Add(this.btnAjouterAbsence);
+            this.Controls.Add(this.dtpDateFin);
+            this.Controls.Add(this.dtpDateDebut);
             this.Controls.Add(this.txtPrenom);
             this.Controls.Add(this.lblPrenom);
             this.Controls.Add(this.txtNom);
             this.Controls.Add(this.lblNom);
             this.Controls.Add(this.dgvAbsence);
-            this.Controls.Add(this.btnAjouterAbsence);
+            this.Controls.Add(this.btnEnregistrerAbsence);
             this.Controls.Add(this.cbbMotif);
-            this.Controls.Add(this.txtDateDebut);
-            this.Controls.Add(this.txtDateFin);
             this.Controls.Add(this.lblMotif);
             this.Controls.Add(this.lblDateFin);
             this.Controls.Add(this.lblDateDebut);
@@ -226,10 +249,8 @@
 
         #endregion
 
-        private System.Windows.Forms.Button btnAjouterAbsence;
+        private System.Windows.Forms.Button btnEnregistrerAbsence;
         private System.Windows.Forms.ComboBox cbbMotif;
-        private System.Windows.Forms.TextBox txtDateDebut;
-        private System.Windows.Forms.TextBox txtDateFin;
         private System.Windows.Forms.Label lblMotif;
         private System.Windows.Forms.Label lblDateFin;
         private System.Windows.Forms.Label lblDateDebut;
@@ -241,5 +262,9 @@
         private System.Windows.Forms.TextBox txtNom;
         private System.Windows.Forms.Label lblPrenom;
         private System.Windows.Forms.TextBox txtPrenom;
+        private System.Windows.Forms.DateTimePicker dtpDateDebut;
+        private System.Windows.Forms.DateTimePicker dtpDateFin;
+        private System.Windows.Forms.Button btnAjouterAbsence;
+        private System.Windows.Forms.Button btnAnnulerAjout;
     }
 }
\ No newline at end of file
diff --git a/MediaTek86/vue/GererAbsence.cs b/MediaTek86/vue/GererAbsence.cs
index fa603a5..df40c9b 100644
--- a/MediaTek86/vue/GererAbsence.cs
+++ b/MediaTek86/vue/GererAbsence.cs
@@ -110,6 +110,22 @@ namespace MediaTek86.vue
             Init();
         }
 
+        /// <summary>
+        /// Affiche ou non les zones de texte pour ajouter une absence
+        /// </summary>
+        /// <param name="boolean"></param>
+        public void GererZoneTexte(Boolean boolean)
+        {
+            lblDateDebut.Visible = boolean;
+            lblDateFin.Visible = boolean;
+            lblMotif.Visible = boolean;
+            dtpDateDebut.Visible = boolean;
+            dtpDateFin.Visible = boolean;
+            cbbMotif.Visible = boolean;
+            btnEnregistrerAbsence.Visible = boolean;
+            btnAnnulerAjout.Visible = boolean;
+        }
+
         /// <summary>
         /// Initialisation de la frame : remplissage des listes
         /// </summary>
@@ -118,6 +134,7 @@ namespace MediaTek86.vue
             RemplirListeMotif();
             txtNom.Enabled = false;
             txtPrenom.Enabled = false;
+            GererZoneTexte(false);
         }
 
         private void frmGererAbsence_Load(object sender, EventArgs e)
@@ -157,5 +174,43 @@ namespace MediaTek86.vue
         {
             controle.RetourListePerso();
         }
+
+        /// <summary>
+        /// Enregistre et ajoute une absence
+        /// </summary>
+        /// <param name="sender"></param>
+        /// <param name="e"></param>
+        private void btnEnregistrerAbsence_Click(object sender, EventArgs e)
+        {
+            if (cbbMotif.SelectedIndex != -1)
+            {
+                controle.AddAbsence(GetIdPersonnel(), GetNom(), GetPrenom(), dtpDateDebut.Value, dtpDateFin.Value);
+            }
+            else
+            {
+                MessageBox.Show("Tous les champs doivent Ãªtre remplis.", "Information");
+            }
+        }
+
+        /// <summary>
+        /// Affiche les zones de textes pour ajouter une absence
+        /// </summary>
+        /// <param name="sender"></param>
+        /// <param name="e"></param>
+        private void btnAjouterAbsence_Click_1(object sender, EventArgs e)
+        {
+            GererZoneTexte(true);
+        }
+
+        /// <summary>
+        /// Annule l'ajout d'une absence
+        /// </summary>
+        /// <param name="sender"></param>
+        /// <param name="e"></param>
+        private void btnAnnulerAjout_Click(object sender, EventArgs e)
+        {
+            GererZoneTexte(false);
+        }
+
     }
 }
-- 
2.49.0.windows.1

